## GENERATED AS IDENTITY
# 오라클 식별자 컬럼(Oracle Identity Columns)
```
식별자 컬럼은 기본 키를 대신하기 유용하다.
새 행을 삽입하면 오라클이 자동으로 식별자 컬럼의 값을 자동으로 생성
컬럼에 순차적으로 삽입한다.
```
> ### 구 버전
```sql
--오라클 시퀸시를 생성
CREATE SEQUENCE EMP_SEQ INCREMENT BY 1 START WITH 1;
--테이블 생성
CREATE TABLE EMP_TMP2(
    EMP_NO NUMBER(4),
    EMP_NAME VARCHAR2(20),
    CONSTRAINT PK_EMPTMP_EMPNO
    PRIMARY KEY(EMP_NO)
);
--시퀸스 적용
INSERT INTO EMP_TMP2 VALUES (EMP_SEQ.NEXTVAL,'둘리');
INSERT INTO EMP_TMP2 VALUES (EMP_SEQ.NEXTVAL,'또치');
SELECT * FROM EMP_TMP2;
--확인
/*
    1 또치
    2 둘리
    자동 증분을 하기위해 오라클 스키마 객체를 생성해서 사용하며
    다음값을 가져와서 반환할때에는 시퀸스 이름.NEXTVAL
    현재값을 가져와서 반환할때에는 시퀸스 이름.CURRVAL
*/
```
> ## 12c버전 이후
`기본 형식`
```sql
GENERATED [ALWAYS|BY DEFAULT[ON NULL]] AS IDENTITY [( identity_options )] 

GENERATED ALWAYS :  항상 ID 컬럼의 값을 생성합니다. 
                    그래서 개발자가 ID 컬럼에 값을 입력하면 오류가 발생

GENERATED BY DEFAULT : ID 컬럼 값을 제공하지 않으면 자동 생성하며 
                       값을 제공하면 해당 값을 ID 컬럼에 입력합니다. 
                       이 옵션의 경우 ID 컬럼에 NULL 값을 삽입하면 오류가 발생합니다.

GENERATED BY DEFAULT ON NULL : 사용자가 NULL 값을 제공하거나 값이 없는 경우 
                               ID 컬럼에 대한 값을 생성합니다.

identity_option

START WITH   initial_value는 ID 컬럼에 사용할 초기 값을 지정합니다. 
             기본 초기 값은 1입니다.
INCREMENT BY internval_value는 생성 된 값 사이의 간격을 정의합니다. 
             기본적으로 간격 값은 1입니다.
CACHE는      Oracle이 성능 향상을 위해 미리 생성해야하는 값의 수를  정의합니다. 

--기본 SEQUENCE와 비슷한 문법이다
```
__기본 예시와 오류 예제__
```sql
CREATE TABLE EMP_TMP2(
    EMPNO NUMBER GENERATED AS IDENTITY,
    ENAME VARCHAR2(50),
    CONSTRAINT PK_EMPTMP2_NO
    PRIMARY KEY(EMPNO)
);
/*
GENERATED AS IDENTITY 옵션은 오라클이 무조건 식별자 컬럼의 값을 생성하므로 
값을 입력하면 오류가 발생한다
*/
INSERT INTO EMP_TMP2 (ENAME) VALUES ('둘리');
INSERT INTO EMP_TMP2 (ENAME) VALUES ('또치');
--문제 없이 sql이 실행된다.
INSERT INTO EMP_TMP2 (EMPNO,ENAME) VALUES (4,'둘리');
--예외가 발생한다. 식별자컬럼에는 값을 집어넣을수가 없다.
--오류: ORA-32795: generated always ID 열에 삽입할 수 없습니다.
--GENERATED AS IDENTITY 옵션으로 생성한 식별자 컬럼은
--오라클이 항상 값을 생성하므로 값을 입력하면 예외가 발생한다.
```
> ### 식별자 컬럼에 값을 입력할때도 있고 값을 입력하지 않을 때 라면
`GENERATED BY DEFAULT AS IDENTITY`
```SQL
/*
    값을 입력하지 않으면 오라클이 자동으로 값을 생성,
    값을 입력하면 입력한 값을 사용한다.
*/
CREATE TABLE EMP_TMP2(
    EMP_NO NUMBER   GENERATED BY DEFAULT AS IDENTITY START WITH 500,
    ENAME VARCHAR2(50),
    CONSTRAINT PK_EMP_NO
    PRIMARY KEY (EMP_NO)
);
INSERT INTO EMP_TMP2 (ENAME) VALUES ('둘리'); --500
INSERT INTO EMP_TMP2 (EMP_NO,ENAME) VALUES (501,'희동'); --501
INSERT INTO EMP_TMP2 (ENAME) VALUES ('또치'); --501
/*
한칸 건너 뛰어주는게 아니라 예외가 발생한다.
ORA-00001: 무결성 제약 조건(C##OT.PK_EMP_NO)에 위배됩니다
*/
ALTER TABLE EMP_TMP2 
MODIFY (EMP_NO GENERATED BY DEFAULT AS IDENTITY START WITH 502);
--다시 증분할수 있도록 해당 시작점을 변경해주면 해결이 된다.
/*
    또는 실행문에서 실행이 될때마다 INCREMENT가 되는 방식이기 때문에
    한번 더 실행문을 실행하면 다음번호로 실행이 된다.
*/
```
> ### GENERATED BY DEFAULT ON NULL AS IDENTITY 옵션.
```SQL
/*
    식별자 컬럼에 값이 없거나 NULL값이 입력되는 경우에는
    오라클이 식별자 컬럼의 값을 자동생성하고 
    NULL 아닌 값이 입력된다면 이를 입력값으로 받아주는 옵션
*/
CREATE TABLE EMP_TMP2(
    EMPNO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    ENAME VARCHAR2(50),
    CONSTRAINT PK_TMP_NO
    PRIMARY KEY (EMPNO)
);
INSERT INTO EMP_TMP2 (ENAME) VALUES ('둘리');
INSERT INTO EMP_TMP2 (EMPNO,ENAME) VALUES (2,'또치');
INSERT INTO EMP_TMP2 (EMPNO,ENAME) VALUES (NULL,'둘리');
SELECT * FROM EMP_TMP2;
```
> 시작지점과 증가폭 설정하기
```SQL
CREATE TABLE EMP_TMP2(
    EMPNO NUMBER GENERATED 
        AS IDENTITY START WITH 500 INCREMENT BY 10,
    ENAME VARCHAR2(50),
    CONSTRAINT PK_EMP
    PRIMARY KEY (EMPNO)
);
INSERT INTO EMP_TMP2 (ENAME) VALUES ('둘리');
INSERT INTO EMP_TMP2 (ENAME) VALUES ('희동');
INSERT INTO EMP_TMP2 (ENAME) VALUES ('또치');

--
     EMPNO ENAME
---------- ----------
       500 둘리
       510 희동
       520 또치
```